<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>by mautasim</title>
<meta name="viewport"tcontent="width=device-width, initial-scale=1">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;padding:10px}
#bill{background:#fff;border:2px solid #000;max-width:850px;margin:auto;padding:15px}
.center{text-align:center}
.box{border:1px solid #000;padding:8px;margin-top:8px}
.flex{display:flex;gap:10px}
.flex>div{width:50%}
input{width:100%;padding:4px;margin:2px 0;box-sizing:border-box}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #000;padding:6px;text-align:center}
.right{text-align:right}
button{padding:10px;margin-top:10px;width:100%}
canvas{border:1px solid #000;touch-action:none}
.logo{max-height:80px}
.footer{margin-top:10px;border-top:1px solid #000;padding-top:5px}
.date-box{display:flex;align-items:center;gap:6px}

@media print {
  #bill{width:210mm}
}
</style>
</head>

<body>

<div id="bill">

<div class="center">
<img id="logoPreview" class="logo" src="logo.png"><br>
<h2>Naveed Textiles</h2>
</div>

<div class="box">
<b>Shop Name</b>
<input value="NAVEED TEXTILES">
<b>Address</b>
<input value="Takiya Khurhama">
<b>Phone</b>
<input value="9906403030 / 9906851124">
<b>Email</b>
<input value="naveedtextiles14@gmail.com">
</div>

<div class="box flex">
<div>
<b>Bill To</b>
<input placeholder="Customer Name">
<input placeholder="Customer Address">
<input placeholder="Customer Phone">
</div>
<div>
<b>Bill No</b>
<input id="invoiceNo" readonly>
<b>Date</b>
<div class="date-box">
<span>ðŸ“…</span>
<input type="date" id="billDate">
</div>
</div>
</div>

<table id="items">
<tr>
<th>#</th><th>Item</th><th>Qty</th><th>Price</th><th>Amount</th>
</tr>
<tr>
<td>1</td>
<td><input></td>
<td><input type="number" oninput="calc()"></td>
<td><input type="number" oninput="calc()"></td>
<td class="amt">0</td>
</tr>
</table>

<button onclick="addRow()">Add Item</button>

<div class="box right">
Discount % <input id="disc" value="0" oninput="calc()"><br>
GST % <input id="gst" value="0" oninput="calc()"><br>
<h3 id="total">Total: â‚¹0</h3>

Paid Amount
<input id="paid" type="number" value="0" oninput="calcBalance()">
<h3 id="balance">Balance: â‚¹0</h3>
</div>

<div class="box">
<b>Authorized Signature</b><br>
<canvas id="sign" width="300" height="120"></canvas>
<button onclick="clearSign()">Clear Signature</button>
</div>

<div class="center footer">
Web built by Mautasim
</div>

</div>

<button onclick="downloadPDF()">Download PDF</button>

<script>
// Auto invoice number
let last = localStorage.getItem("lastInvoice") || 1000;
last++;
localStorage.setItem("lastInvoice", last);
document.getElementById("invoiceNo").value = "INV-" + last;

// Today date
document.getElementById("billDate").value =
new Date().toISOString().split("T")[0];

// Add row
function addRow(){
let t=document.getElementById("items");
let r=t.insertRow();
r.innerHTML=`<td>${t.rows.length-1}</td>
<td><input></td>
<td><input type=number oninput=calc()></td>
<td><input type=number oninput=calc()></td>
<td class=amt>0</td>`;
}

// Calculate total
function calc(){
let sum=0;
document.querySelectorAll("#items tr").forEach((r,i)=>{
if(i>0){
let q=r.cells[2].firstChild.value||0;
let p=r.cells[3].firstChild.value||0;
let a=q*p;
r.cells[4].innerText=a;
sum+=a;
}
});
let d=sum*(disc.value/100);
let g=sum*(gst.value/100);
document.getElementById("total").innerText="Total: â‚¹"+(sum-d+g);
calcBalance();
}

// Balance
function calcBalance(){
let t=parseFloat(total.innerText.replace(/[^0-9.]/g,''))||0;
let p=parseFloat(paid.value)||0;
document.getElementById("balance").innerText="Balance: â‚¹"+(t-p);
}

// Signature
let c=sign,ctx=c.getContext("2d"),draw=false;
c.onmousedown=()=>draw=true;
c.onmouseup=()=>{draw=false;ctx.beginPath();}
c.onmousemove=e=>{if(draw){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke();}}
c.addEventListener("touchstart",e=>{draw=true;let t=e.touches[0];ctx.moveTo(t.clientX-c.offsetLeft,t.clientY-c.offsetTop)})
c.addEventListener("touchmove",e=>{if(draw){let t=e.touches[0];ctx.lineTo(t.clientX-c.offsetLeft,t.clientY-c.offsetTop);ctx.stroke()}})
c.addEventListener("touchend",()=>draw=false);

function clearSign(){ctx.clearRect(0,0,c.width,c.height);}

// Download PDF (mobile fixed)
function downloadPDF(){
const bill=document.getElementById("bill");
const clone=bill.cloneNode(true);

clone.querySelectorAll("input").forEach(i=>{
let s=document.createElement("span");
s.innerText=i.value;
i.replaceWith(s);
});

let img=document.createElement("img");
img.src=sign.toDataURL();
img.style.width="200px";
clone.querySelector("canvas")?.replaceWith(img);

html2pdf().set({
margin:10,
filename:"Invoice.pdf",
html2canvas:{scale:3,windowWidth:1200},
jsPDF:{unit:"mm",format:"a4"}
}).from(clone).save();
}
</script>

</body>
</html>
