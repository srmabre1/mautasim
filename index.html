<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>by mautasim</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family:Segoe UI,Arial;
  background:linear-gradient(135deg,#e3f2fd,#fce4ec);
  padding:15px;
}
.container{
  max-width:1000px;
  margin:auto;
  background:#fff;
  padding:25px;
  border-radius:15px;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
}
h1{text-align:center;margin-bottom:20px}

.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:12px;
}
.row input{
  flex:1;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}
th,td{
  border:1px solid #ddd;
  padding:10px;
  text-align:center;
}
th{
  background:#1976d2;
  color:white;
}
tr:nth-child(even){background:#f9f9f9}

button{
  padding:10px 16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
}
.add{background:#2e7d32;color:white;margin-top:10px}
.remove{background:#c62828;color:white}
.blue{background:#1565c0;color:white}
.gray{background:#616161;color:white}

.summary{
  background:#f1f8ff;
  margin-top:20px;
  padding:15px;
  border-radius:10px;
}
.summary div{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}

.actions{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:space-between;
  margin-top:20px;
}

.signature{
  margin-top:30px;
  padding:15px;
  background:#fafafa;
  border-radius:10px;
}

@media print{
  .actions,.add,.remove{display:none}
  body{background:white}
  .container{box-shadow:none}
}
</style>
</head>

<body>
<div class="container">
<h1>Naveed Textiles</h1>

<div class="row">
  <input id="shopName" placeholder="Shop Name">
  <input id="billNo" placeholder="Bill No">
  <input type="date" id="billDate">
</div>

<div class="row">
  <input id="customerName" placeholder="Customer Name">
  <input id="customerMobile" placeholder="Customer Mobile number">
</div>

<table id="billTable">
<thead>
<tr>
  <th>Item</th>
  <th>Qty</th>
  <th>Price</th>
  <th>Total</th>
  <th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button class="add" onclick="addRow()">+ Add Item</button>

<div class="summary">
  <div><span>Sub Total</span><span>₹ <span id="subTotal">0</span></span></div>
  <div>
    <span>GST (%)</span>
    <input type="number" id="gst" value="0" oninput="calculate()" style="width:80px">
  </div>
  <div>
    <span>Discount (%)</span>
    <input type="number" id="discount" value="0" oninput="calculate()" style="width:80px">
  </div>
  <div><strong>Grand Total</strong><strong>₹ <span id="grandTotal">0</span></strong></div>
</div>

<div class="signature">
<strong>Authorized Signature</strong><br>
<canvas id="signPad" width="300" height="120" style="border:1px solid #000;margin-top:10px"></canvas><br>
<button class="gray" onclick="clearSign()">Clear Signature</button>
</div>

<div class="actions">
<button class="blue" onclick="window.print()">Print</button>
<button class="gray" onclick="saveBill()">Save Bill</button>
<button class="blue" onclick="downloadPDF()">Download PDF</button>
<button class="gray" onclick="loadBill()">Load Last Bill</button>
</div>
</div>

<script>
function addRow(item='',qty=1,price=0){
  const tb=document.querySelector('#billTable tbody');
  const tr=document.createElement('tr');
  tr.innerHTML=`
  <td><input value="${item}"></td>
  <td><input type="number" value="${qty}" oninput="calculate()"></td>
  <td><input type="number" value="${price}" oninput="calculate()"></td>
  <td class="rowTotal">0</td>
  <td><button class="remove" onclick="this.closest('tr').remove();calculate()">X</button></td>`;
  tb.appendChild(tr);
  calculate();
}

function calculate(){
  let sub=0;
  document.querySelectorAll('#billTable tbody tr').forEach(r=>{
    let q=+r.children[1].firstChild.value||0;
    let p=+r.children[2].firstChild.value||0;
    let t=q*p;
    r.querySelector('.rowTotal').innerText=t.toFixed(2);
    sub+=t;
  });
  subTotal.innerText=sub.toFixed(2);
  let g=+gst.value||0;
  let d=+discount.value||0;
  let grand=sub+(sub*g/100)-(sub*d/100);
  grandTotal.innerText=grand.toFixed(2);
}

function saveBill(){
  const data={
    shop:shopName.value,
    bill:billNo.value,
    date:billDate.value,
    customer:customerName.value,
    mobile:customerMobile.value,
    gst:gst.value,
    discount:discount.value,
    items:[...document.querySelectorAll('#billTable tbody tr')].map(r=>({
      item:r.children[0].firstChild.value,
      qty:r.children[1].firstChild.value,
      price:r.children[2].firstChild.value
    })),
    sign:signPad.toDataURL()
  };
  localStorage.setItem('bill',JSON.stringify(data));
  alert("Bill Saved");
}

function loadBill(){
  const d=JSON.parse(localStorage.getItem('bill'));
  if(!d) return alert("No saved bill");
  shopName.value=d.shop;
  billNo.value=d.bill;
  billDate.value=d.date;
  customerName.value=d.customer;
  customerMobile.value=d.mobile;
  gst.value=d.gst;
  discount.value=d.discount;
  document.querySelector('#billTable tbody').innerHTML='';
  d.items.forEach(i=>addRow(i.item,i.qty,i.price));
  let img=new Image();
  img.onload=()=>ctx.drawImage(img,0,0);
  img.src=d.sign;
}

const canvas=document.getElementById('signPad');
const ctx=canvas.getContext('2d');
let draw=false;
canvas.onmousedown=()=>draw=true;
canvas.onmouseup=()=>draw=false;
canvas.onmousemove=e=>{
  if(!draw) return;
  ctx.lineWidth=2;
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
};

function clearSign(){ctx.clearRect(0,0,canvas.width,canvas.height)}

async function downloadPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text(`Shop: ${shopName.value}`,10,10);
  pdf.text(`Bill No: ${billNo.value}`,10,20);
  pdf.text(`Grand Total: ₹ ${grandTotal.innerText}`,10,30);
  pdf.addImage(canvas.toDataURL(),'PNG',10,40,60,25);
  pdf.save("bill.pdf");
}

addRow();
</script>
</body>
</html>

